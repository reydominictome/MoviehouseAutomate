<!DOCTYPE html> 
<html lang="en">
	<head>
		{% load static %}
		<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700">
		<title>Registration</title>
		
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
		<!--<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>-->
		<link href="{% static 'css/style.css' %}" rel="stylesheet" type="text/css">
		<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" type="text/css">
		<link href="{% static 'css/CustomerStyles.css' %}" rel="stylesheet" type="text/css">
	</head>

	<body class="body-color">
		<nav class="navbar navbar-dark bg-dark">
			<a class="navbar-brand" href="/main">
		    <img src="{% static 'images/icon.png' %}" width="40" height="30" class="d-inline-block align-top" alt="" loading="lazy">
		    Movie House Automate
		  </a>
		</nav>
		<div class="registration-body-left">
			<div class="back-button">
				<a type="submit" href="/movie/index" class="btn btn-success btn-lg">To Report Summary</a>
			</div>
			<div class="signup-form">
				<form action="" method="POST" enctype="multipart/form-data">
					{% csrf_token %}
					<h2>Register DVD</h2>
			        <table class="a">
			        	<tr>
			        		<td>Date Registered:</td>
							<td><div class="form-group"><input id="date_registered" 
								type="date" class="form-control" name="date_registered" 
								placeholder="MM/DD/YYYY" readonly></div></td>
			        	</tr>
			        	<tr>
			        		<td>SKU:</td>
							<td><div class="form-group"><input id="sku" type="text" class="form-control" 
								name="sku" placeholder="" required="required" readonly></div></td>
			        	</tr>
			        	<tr><td>&nbsp;</td></tr>
			        	<tr>
			        		<td>Genre:</td>
			        		<td>
			        			<div class="form-group">
			        				<table class="a">
			        					<tr>
			        						<td>
			        							<input type="checkbox" id="action" name="genre" value="Action">
												<label for="action">Action</label>
			        						</td>
			        						<td>
			        							<input type="checkbox" id="history" name="genre" value="History">
												<label for="history">History</label>
			        						</td>
			        					</tr>
			        					<tr>
			        						<td>
			        							<input type="checkbox" id="comedy" name="genre" value="Comedy">
												<label for="comedy">Comedy</label>
			        						</td>
			        						<td>
			        							<input type="checkbox" id="horror" name="genre" value="Horror">
												<label for="horror">Horror</label>
			        						</td>
			        					</tr>
			        					<tr>
			        						<td>
			        							<input type="checkbox" id="drama" name="genre" value="Drama">
												<label for="drama">Drama</label>
			        						</td>
			        						<td>
			        							<input type="checkbox" id="romance" name="genre" value="Romance">
												<label for="romance">Romance</label>
			        						</td>
			        					</tr>
			        					<tr>
			        						<td>
			        							<input type="checkbox" id="fantasy" name="genre" value="Fantasy">
												<label for="fantasy">Fantasy</label>
			        						</td>
			        						<td>
			        							<input type="checkbox" id="sci-fi" name="genre" value="Sci-fi">
												<label for="sci-fi">Sci-fi</label>
			        						</td>
			        					</tr>
			        				</table>
			        			</div>
			        		</td>
			        	</tr>
			        	<tr><td>&nbsp;</td></tr>
			        	<tr>
			        		<td>Title:</td>
							<td><div class="form-group"><input id="title" type="text" max="100" class="form-control" 
								name="title" placeholder="Title" required="required"></div></td>
			        	</tr>
			        	<tr>
			        		<td>Release Date:</td>
							<td><div class="form-group"><input id="release_date" type="date" class="form-control" 
								name="release_date" placeholder="DD/MM/YYYY" required="required"></div></td>
			        	</tr>
			        	<tr>
			        		<td>Director:</td>
							<td><div class="form-group"><input id="director" type="text" max="100" class="form-control" 
								name="director" placeholder="First name, Last name" required="required"></div></td>
			        	</tr>
			        	<tr><td>&nbsp;</td></tr>
						<tr>
							<td>Casts:</td>
							<td>
								<div class="input-group mb-3">
								  <input type="text" max="100 "class="form-control" id="cast" 
								  placeholder="First Name, Last Name" value="">
								  <div class="input-group-append">
									<button class="btn btn-success" type="button" 
									onclick="addToList()" style="font-size: 11px">Add Cast</button>
								  </div>
								</div>
								<input type="text" class="form-control" id="casts" name="casts" 
								placeholder="First name, Last name" value="" hidden>
						   </td>
						</tr>
			        	<tr>
			        		<td></td>
			        		<td>
			        			<div class="form-group">
			        				<ul class="list-of-casts" id="cast_list">
										<li class="list-group-item list-group-item-light">No Cast(s)</li>
									</ul>
			        			</div>
							</td>
			        	</tr>
			        	<tr><td>&nbsp;</td></tr>
			        	<tr>
			        		<td>Price:</td>
			           		<td><div class="form-group"><input id="price" type="number" step="0.01" min="0" pattern="[\d*]" max="200" class="form-control" name="price" placeholder="0.00" required="required"></div></td>
			        	</tr>
			        	<tr>
			        		<td>Number of items:</td>
			            	<td><div class="form-group"><input id="no_of_items" type="number" min="0" pattern="[\d*]" max="30" class="form-control" name="no_of_items" placeholder="0" required="required"></div></td>
			        	</tr>
			        	<tr><td>&nbsp;</td></tr>
			        	<tr>
			        		<td>
								DVD cover image:
			        		</td>
			        		<td>
								<div id="wrapper" class="text-left">
									<input id="fileName" type="file" accept="image/*" name="cover_image" onchange="preview_image(event)">
									<br>
									<!--<div class="for-output-img">-->
									<div style="margin-top:15px;margin-bottom:15px;height:200px;width:300px;">
										<img id = "output_image" style="height:100%;width:100%;" src = "{% static 'images/default-dvd.png' %}"/>
									</div>
								</div>
							</td>
			        	</tr>
			        </table>

					<div class="form-group">
			            <button type="submit" class="btn btn-success btn-lg btn-block">Register DVD</button>
			        </div>
			    </form>
			</div>
		</div>

		<div class="modal" id="img-alert" role="dialog">
			<div class="modal-dialog">
	  
			  <!--MODAL CONTENT-->
			  <div class="modal-content">
				<div class="modal-header">
				  <h4 class="modal-title">Notification</h4>
				  <button type="button" class="close" data-dismiss="modal">&times;</button>
				</div>
				<div class="modal-body" style="overflow-y:hidden;">
				  <p>
					Please input an image. (JPG, JPEG, PNG)
				  </p>
				</div>
				<div class="modal-footer">
				  <button type="button" class="btn btn-success btn-sm" data-dismiss="modal">Confirm</button>
				</div>
			  </div>
	  
			</div>
		  </div>
	</body>

	<script src="{% static 'js/jquery-3.5.1.min.js' %}"></script>
	<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script> -->
	<script src="{% static 'js/bootstrap.min.js' %}"></script>

	<script type='text/javascript'>
		var casts = [];
		var returnword;

		function preview_image(event) 
		{
			var fileName = document.getElementById('fileName').value;
			var idxDot = fileName.lastIndexOf('.') + 1;
			var extFile = fileName.substr(idxDot, fileName.length).toLowerCase();
			if (extFile=='jpg' || extFile=='jpeg' || extFile=='png'){
				{
				var reader = new FileReader();
				reader.onload = function()
				{
					var output = document.getElementById('output_image');
					output.src = reader.result;
				}
				reader.readAsDataURL(event.target.files[0]);
				}
			}else{
				$('#img-alert').modal('show');
				document.getElementById('fileName').value = '';
				document.getElementById('output_image').value = '';
				document.getElementById('output_image').src = "{% static 'images/default-dvd.png' %}";
			}   
		}

		function addToList()  
		{
			var returnword = document.getElementById('cast').value;
			var currVal = document.getElementById('casts').value;
			casts.push(returnword);
			$('#casts').val(casts.join(', '));
			$('#cast').val('');
			document.getElementById('cast').value = "";

			$('#cast_list').empty();
			for (var i = 0; i < casts.length; ++i) {
			$('#cast_list').append('<li class="list-group-item list-group-item-light" data-value="' + casts[i] + '">' + casts[i] + ' <button class="btn btn-danger float-right p-0 m-0 cast-delete">X</button></li>');
			}
			$(document).on('click', '.cast-delete', function (e) {
				var val = $(this).parent().data('value');
				casts = jQuery.grep(casts, function(value) {
				return value != val;
				});
				$('#casts').val(casts.join(', '));
				$(this).parent().remove();
				if (casts.length === 0) {
					var message = '<li class="list-group-item list-group-item-light">No Cast(s)</li>';
          			document.getElementById('cast_list').innerHTML = message;
				}
			});
		}

		$(document).ready(function () {
			var currDate = new Date();
			var day = ("0" + currDate.getDate()).slice(-2);
			var month = ("0" + (currDate.getMonth() + 1)).slice(-2);
			var today = currDate.getFullYear()+"-"+(month)+"-"+(day) ;
			document.getElementById('date_registered').value = today;
			document.getElementById('sku').value = +currDate;  
		})

		// Get the button that opens the modal
		var btn = document.querySelectorAll("button.modal-button");

		// All page modals
		var modals = document.querySelectorAll('.modal');

		// Get the <span> element that closes the modal
		var spans = document.getElementsByClassName("close");

		// Get the cancel buttons that closes the modal
		var btnCancel = document.getElementsByClassName("cancel");

		// When the user clicks the button, open the modal
		for (var i = 0; i < btn.length; i++) {
		btn[i].onclick = function(e) {
			e.preventDefault();
			modal = document.querySelector(e.target.getAttribute("href"));
			modal.style.display = "block";
			}
		}

		// When the user clicks on cancel button, close the modal
		for (var i = 0; i < btnCancel.length; i++) {
		btnCancel[i].onclick = function() {
			for (var index in modals) {
			if (typeof modals[index].style !== 'undefined') modals[index].style.display = "none";    
			}
			}
		}

		// When the user clicks on <span> (x), close the modal
		for (var i = 0; i < spans.length; i++) {
		spans[i].onclick = function() {
			for (var index in modals) {
			if (typeof modals[index].style !== 'undefined') modals[index].style.display = "none";    
				}
			}
		}

		// When the user clicks anywhere outside of the modal, close it
		window.onclick = function(event) {
			if (event.target.classList.contains('modal')) {
			for (var index in modals) {
			if (typeof modals[index].style !== 'undefined') modals[index].style.display = "none";    
				}
			}
		}
	</script>

	{% if messages %}
	<script>
	$(document).ready(function(){
		$("#message").modal('show');
	});
	</script>
	{% endif %}
</html>

<!--Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon"> www.flaticon.com</a>-->